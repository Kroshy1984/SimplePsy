<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="initial-scale=1, width=device-width" />

    <link rel="stylesheet" type="text/css" th:href="@{/css/new-front/global.css}" />
    <link rel="stylesheet" type="text/css" th:href="@{/css/new-front/default-page.css}" />
    <link rel="stylesheet" type="text/css" th:href="@{/css/new-front/session/report-create.css}" />
    <link rel="stylesheet" type="text/css" th:href="@{/css/new-front/session/projective-modal.css}" />
    <link
            rel="stylesheet"
            href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700;900&display=swap"
    />
    <link
            rel="stylesheet"
            href="https://fonts.googleapis.com/css2?family=Rubik:wght@400&display=swap"
    />
</head>
<body>
<div class="div139">
    <div class="sidebar1 sidebar1-fix-width">
        <div class="menu">
            <div class="frame-wrapper73">
                <div class="frame-parent122">
                    <div class="frame-parent123">
                        <div class="client-list-wrapper">
                            <button class="base90" onclick="window.location.href='/SimplePsy/V1/specialist/customers';"></button>
                            <div class="icon-wrapper33">
                                <img class="icon146" alt="" src="/images/icon-3@2x.png" />
                            </div>
                            <b class="client-list">Список клиентов</b>
                        </div>
                        <div class="base-frame">
                            <button class="calendar-wrapper" id="baseContainer" onclick="window.location.href='/SimplePsy/V1/session/calendar';">
                                <div class="icon-wrapper34">
                                    <img class="icon147" alt="" src="/images/icon-41@2x.png"/>
                                </div>
                                <b class="calendar">Календарь</b>
                            </button>
                        </div>
                    </div>
                    <div class="frame-parent123">
                        <div class="notifications-wrapper">
                            <button class="base90 fix-angle-base90" onclick="alert('Эта кнопка находится в разработке')"></button>
                            <div class="icon-wrapper33">
                                <img class="icon146" alt="" src="/images/icon-5.svg" />
                            </div>
                            <b class="notifications">Уведомления</b>
                        </div>
                        <div class="base-frame">
                            <button class="calendar-wrapper" id="baseContainer" onclick="alert('Эта кнопка находится в разработке')">
                                <div class="icon-wrapper34">
                                    <img class="icon147" alt="" src="/images/icon-6.svg"/>
                                </div>
                                <b class="analytics">Аналитика</b>
                            </button>
                        </div>
                        <div class="tests-wrapper">
                            <button class="base94" onclick="window.location.href='/SimplePsy/V1/scoring/list';"></button>
                            <b class="surveys-tests">Опросники и тесты</b>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="feedback-item">
            <div class="feedback-button">
                <img
                        class="icon30"
                        loading="lazy"
                        alt=""
                        src="/images/icon-7@2x.png"
                />

                <div class="frame-parent13" onclick="alert('Эта кнопка находится в разработке')">
                    <div class="send-feedback-container">
                        <b class="send-feedback1">Обратная связь</b>
                    </div>
                    <img
                            class="icon31"
                            loading="lazy"
                            alt=""
                            src="/images/icon-8.svg"
                    />
                </div>
            </div>
        </div>
        <div class="head">
            <div class="wrapper-user8">
                <img
                        class="user-icon"
                        loading="lazy"
                        alt=""
                        th:src="@{'/SimplePsy/V1/specialist/avatar/' + ${specialist.id}}"
                        id="userImage"
                        onclick="window.location.href='/SimplePsy/V1/specialist/personal-info'"
                />
            </div>
            <div class="frame-parent50">
                <div class="hello-wrapper">
                    <b class="hello">Привет, </b>
                    <b th:text="${specialist.name}" class="hello" ></b>
                    <b class="hello">!</b>
                </div>
                <b class="specialist-email">
                    <p th:text="${specialist.username}" class="specialist-email-content"></p>
                </b>
            </div>
        </div>
    </div>
    <header class="head1">
        <div class="navigate">
            <a class="constructor8" href="/SimplePsy/V1/session/calendar">Понятная практика</a>
            <div class="menu1">
                <b class="news9" id="newsText">Назначить встречу</b>
                <b class="user-policy9" id="userPolicyText"
                >Добавить график нерабочих дней
                </b>
                <b class="about-us15" id="aboutUsText">Добавить клиента</b>
            </div>
            <input type="hidden" id="currentSpecialistId" th:value="${specialist.id}">
            <div class="search8">
                <img
                        class="icon121"
                        loading="lazy"
                        alt=""
                        src="/images/icon-1@2x.png"
                />
                <input type="text" class="search1" placeholder="Найти клиента..." list="customerList" id="customerSearch" autocomplete="off">
                <datalist id="customerList">

                </datalist>
            </div>
            <div class="city">
                <b th:text="${specialist.city}" class="specialist-city"></b>
                <img
                        class="icon122"
                        loading="lazy"
                        alt=""
                        src="/images/icon-2@2x.png"
                />
            </div>
            <img
                    class="icon123"
                    loading="lazy"
                    alt=""
                    src="/images/icon@2x.png"
            />
        </div>
    </header>
    <div class="container">
        <div class="frame-wrapper52">
            <div class="frame-parent83">
                <img class="frame-child80" alt="" src="/images/group-35.svg" />

                <div class="frame-parent84">
                    <div class="frame-wrapper53">
                        <div class="parent11">
                            <b class="b100">Встреча</b>
                            <div class="about-us-wrapper">
                                <b class="about-us8" th:text="'Дата встречи: ' + ${formattedDate}"></b>
                            </div>
                            <div class="about-us-frame">
                                <b class="about-us9" th:text="'Время встречи: с ' + ${sessionDTO.timeStart} + ' по ' + ${sessionDTO.timeFinish}"></b>
                            </div>
                        </div>
                    </div>
                    <div class="about-us-parent1">
                        <b class="about-us10">
                            <p class="p33">Тип оплаты:</p>
                            <p class="p34" th:text="${sessionDTO.paymentType.translation}"></p>
                        </b>
                        <b class="about-us11">
                            <p class="p35">Итоговая сумма:</p>
                            <p class="p36">5000</p>
                        </b>
                    </div>
                </div>
                <div class="frame-parent85">
                    <div class="about-us-parent2">
                        <b class="about-us12">
                            <p class="p37">Дата следующей встречи:</p>
                            <p class="p38">27.03.2024</p>
                        </b>
                        <b class="about-us13">
                            <p class="p39">Время следующей встречи:</p>
                            <p class="p40">с 18:00 по 20:00</p>
                        </b>
                    </div>
                    <div class="frame-wrapper54">
                        <div class="about-us-parent3" th:switch="${sessionDTO.customer.typeOfClient}">
                            <div th:case="${sessionDTO.customer.typeOfClient.ADULT}">
                                <b class="about-us14"  th:text="${sessionDTO.customer.surname + ' ' + sessionDTO.customer.name}"></b>
                                <b class="news8" th:text="${sessionDTO.customer.contact.phone}">Номер телефона</b>
                                <b class="user-policy8" th:text="${sessionDTO.customer.contact.email}">E-mail</b>
                            </div>
                            <div th:case="${sessionDTO.customer.typeOfClient.COUPLE}">
                                <b class="about-us14" th:text="${sessionDTO.customer.firstClientSurname + ' ' + sessionDTO.customer.firstClientName}"></b>
                                <b class="news8" th:text="${sessionDTO.customer.firstClientContact.phone}">Номер телефона</b>
                                <b class="user-policy8" th:text="${sessionDTO.customer.firstClientContact.email}">E-mail</b>
                            </div>
                            <div th:case="${sessionDTO.customer.typeOfClient.CHILD}">
                                <b class="about-us14" th:text="${sessionDTO.customer.childSurname + ' ' + sessionDTO.customer.childName}"></b>
                                <b class="news8" th:text="${sessionDTO.customer.childContact.phone}">Номер телефона</b>
                                <b class="user-policy8" th:text="${sessionDTO.customer.childContact.email}">E-mail</b>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <h2>Заметка о ходе работы</h2>
        <form id="test-edit-form" th:action="@{/SimplePsy/V1/session/report}" th:object="${report}" method="post">
            <input type="hidden" th:value="${sessionId}" name="sessionId" id="sessionId">
            <div>
                <label for="requestForSessionByClient">Запрос на сессию со стороны клиента</label>
                <textarea id="requestForSessionByClient" th:text="${report.requestForSessionByClient}"
                          name="requestForSessionByClient" disabled></textarea>
            </div>

            <div>
                <label for="specialistCondition">Состояние терапевта в начале сессии</label>
                <textarea id="specialistCondition" th:text="${report.specialistCondition}"
                          name="specialistCondition" disabled></textarea>
            </div>

            <div>
                <label for="sessionTopics">Основные темы, затронутые в ходе сеанса</label>
                <textarea id="sessionTopics" th:text="${report.sessionTopics}"
                          name="sessionTopics" disabled></textarea>
            </div>

            <div>
                <label for="clientInsides">Значимые фразы, инсайты клиента</label>
                <textarea id="clientInsides" th:text="${report.clientInsides}"
                          name="clientInsides" disabled></textarea>
            </div>

            <div>
                <label for="clientsEmotions">Основные эмоции клиента</label>
                <textarea id="clientsEmotions" th:text="${report.clientsEmotions}"
                          name="clientsEmotions" disabled></textarea>
            </div>

            <div>
                <label for="specialistEmotions">Основные проявленные эмоции терапевта</label>
                <textarea id="specialistEmotions" th:text="${report.specialistEmotions}"
                          name="specialistEmotions" disabled></textarea>
            </div>

            <div>
                <label for="unmanifestedSpecialistEmotions">Непроявленные эмоции терапевта</label>
                <textarea id="unmanifestedSpecialistEmotions" th:text="${report.unmanifestedSpecialistEmotions}"
                          name="unmanifestedSpecialistEmotions" disabled></textarea>
            </div>

            <div>
                <label for="techniquesAndMethodsUsed">Применяемые техники и методы</label>
                <textarea id="techniquesAndMethodsUsed" th:text="${report.techniquesAndMethodsUsed}"
                          name="techniquesAndMethodsUsed" disabled></textarea>
            </div>

            <div>
                <label for="clientsSessionResistance">Основные препятствия и способы сопротивления процессу терапии со стороны клиента</label>
                <textarea id="clientsSessionResistance" th:text="${report.clientsSessionResistance}"
                          name="clientsSessionResistance" disabled></textarea>
            </div>

            <div>
                <label for="specialistFinalStatus">Состояние терапевта по завершению сессии</label>
                <textarea id="specialistFinalStatus" th:text="${report.specialistFinalStatus}"
                          name="specialistFinalStatus" disabled></textarea>
            </div>

            <div>
                <label for="plansForNextSession">План и/или мысли на следующую сессию</label>
                <textarea id="plansForNextSession" th:text="${report.plansForNextSession}"
                          name="plansForNextSession" disabled></textarea>
            </div>

            <div>
                <label for="difficultiesForRequestingSuperVisa">Трудности и потенциальные темы для запроса на супервизию</label>
                <textarea id="difficultiesForRequestingSuperVisa" th:text="${report.difficultiesForRequestingSuperVisa}"
                          name="difficultiesForRequestingSuperVisa" disabled></textarea>
            </div>

            <div class="frame-wrapper47">
                <div class="frame-parent71">
                    <div class="wrapper28">
                        <h2 class="h21">Проективные методики</h2>
                    </div>
                    <div class="frame-parent72" th:each="method:${projectiveMethods}" th:data-card-id="${method.id}" onclick="openModalProjective(this)">
                            <div class="frame-child71"></div>
                            <b class="b94" th:text="${method.date}"></b>

                        <div class="rectangle-parent63">
                            <div class="frame-child72"></div>
                            <b class="div76" th:text="${method.name}"></b>
                        </div>
                    </div>
                    <div class="rectangle-parent78">
                        <a class="add-method">+ Добавить методику</a>
                    </div>
                </div>
            </div>
            <div class="save-edit-buttons-wrapper">
                <div class="save-edit-buttons">
                    <button id="cancel" type="button" onclick="cancelButton()" class="rectangle-parent51" style="display: none;">
                        <div class="div72">Отменить</div>
                    </button>
                    <button id="edit" type="button" onclick="showInputs()" class="rectangle-parent51">
                        <div class="div72">Редактировать</div>
                    </button>
                    <button id="save" type="submit" class="rectangle-parent51" style="display: none;">
                        <div class="div72">Сохранить</div>
                    </button>
                </div>
            </div>
        </form>
    </div>
    <div id="modal-projective" class="modal-projective">
        <div class="modal-content-projective">
            <span class="close" onclick="closeModalProjective()">&times;</span>
            <h2 id="modal-title"></h2>
            <p id="modal-date" class="modal-date"></p>
            <div id="modal-images" class="image-container"></div>
            <form id="uploadForm" enctype="multipart/form-data">
                <input type="file" id="imageUpload" name="image" accept="image/*">
                <div id="error-message" style="color:red; display:none;">Пожалуйста, выберите клиента из списка.</div>
                <button type="button" onclick="uploadImages()">Добавить фотографии</button>
            </form>
        </div>
    </div>
    <div id="modal" class="modal">
        <div class="modal-content">
            <span class="close-btn">&times;</span>
            <div id="modal-body"></div>
        </div>
    </div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.3.0/lazysizes.min.js" async></script>
<script defer>
    var holidayBtn = document.querySelector('.user-policy9');
    // Открытие модального окна создания проективной методики
    document.addEventListener('DOMContentLoaded', function() {
    // Получаем элементы
    var modal = document.getElementById('modal');
    var modalBody = document.getElementById('modal-body');
    var closeBtn = document.querySelector('.close-btn');
    var appointLink = document.querySelector('.add-method'); // Элемент "Добавить методику"
    var sessionId = document.getElementById('sessionId').value;
    var addCustomer = document.querySelector('.about-us15');
    // Функция для открытия модального окна
    function openModal() {
        fetch('/SimplePsy/V1/session/report/' + sessionId + '/projective-method')
            .then(response => response.text())
            .then(data => {
                modalBody.innerHTML = data;
                modal.style.display = 'block';
                const script = document.createElement('script');
                script.id = 'dynamic-script';
                script.textContent = `
      document.addEventListener('DOMContentLoaded', function() {
        const imageInput = document.getElementById('images');
        if (imageInput) {
            imageInput.addEventListener('change', function(event) {
                const previewContainer = document.getElementById('imagePreview');
                previewContainer.innerHTML = ''; // Очистить предыдущие превью

                // Проверяем, есть ли файлы для отображения
                if (event.target.files && event.target.files.length > 0) {
                    Array.from(event.target.files).forEach(file => {
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            const img = document.createElement('img');
                            img.src = e.target.result;
                            img.style.width = '100px';
                            img.style.margin = '5px';
                            previewContainer.appendChild(img); // Добавить изображение в контейнер
                        };
                        reader.readAsDataURL(file); // Прочитать содержимое файла как Data URL
                    });
                }
            });
        } else {
            console.error('Input element with id "images" not found.');
        }
    });`
            })
            .catch(error => console.error('Ошибка загрузки:', error));
    }
        function openAddClientModal()
        {
            document.body.style.overflow = 'hidden';
            fetch('/SimplePsy/V1/customer/customer/create/modal')
                .then(response => response.text())
                .then(html => {
                    modalBody.innerHTML = html;
                    modal.style.display = "block";

                    // Добавляем обработчик закрытия модального окна
                    document.querySelector('.close-modal').onclick = function() {
                        modal.style.display = "none";
                    };
                })
                .catch(error => {
                    console.error('Error loading modal content:', error);
                });
        }
        addCustomer.addEventListener('click', openAddClientModal);
    // Функция для закрытия модального окна
    function closeModal() {
        modal.style.display = 'none';
    }

    // Событие клика для открытия модального окна
    appointLink.addEventListener('click', openModal);

    // Событие клика для закрытия модального окна
    closeBtn.addEventListener('click', closeModal);
    });

    function showInputs() {
        // Находим элементы, которые нужно изменить
        var inputsToEnable = document.querySelectorAll('input[disabled]');
        var inputsFieldSetToEnable = document.querySelectorAll('textarea');
        var saveButton = document.getElementById('save');
        var editButton = document.getElementById('edit');
        var cancelButton = document.getElementById('cancel');

        // Убираем атрибут disabled у всех найденных элементов
        inputsToEnable.forEach(function (input) {
            input.removeAttribute('disabled');
        });
        inputsFieldSetToEnable.forEach(function (input) {
            input.removeAttribute('disabled');
        });

        // Показываем кнопки
        saveButton.style.display = 'inline-block';
        editButton.style.display = 'none';
        cancelButton.style.display = 'inline-block';
    }

    function cancelButton() {
        let sessionId = document.getElementById("sessionId").value;
        document.getElementById('cancel').style.display = 'none';
        window.location.href = '/SimplePsy/V1/session/report/' + sessionId;
    }
    // Открытие модального окна создания сессии
    document.addEventListener('DOMContentLoaded', function() {
      // Получаем элементы
      var modal = document.getElementById('modal');
      var modalBody = document.getElementById('modal-body');
      var closeBtn = document.querySelector('.close-btn');
      var appointLink = document.querySelector('.news9'); // Элемент "Назначить встречу"

      // Функция для открытия модального окна
        function openModal() {
            fetch('/SimplePsy/V1/session/session-form')
                .then(response => response.text())
                .then(data => {
                    modalBody.innerHTML = data;
                    modal.style.display = 'block';
                })
                .catch(error => console.error('Ошибка загрузки:', error));

            fetch(`/SimplePsy/V1/customer/findAll/${currentSpecialistId}`)
                .then(response => response.json())
                .then(clients => {
                    const dataList = document.getElementById('clientsList');
                    dataList.innerHTML = '';

                    const script = document.createElement('script');
                    script.id = 'dynamic-script';
                    script.textContent = `
  document.getElementById('clientInput').addEventListener('change', function() {
    const selectedOption = Array.from(document.getElementById('clientsList').options).find(option => option.value === this.value);
    if (selectedOption) {
      const clientId = selectedOption.getAttribute('data-id');
      document.getElementById('clientId').value = clientId; // устанавливаем значение скрытого поля
    }
  });
  // Функция для валидации формы
  function validateForm() {
    const clientId = document.getElementById('clientId').value;
    if (!clientId) {
      document.getElementById('error-message').style.display = 'block'; // Показываем сообщение об ошибке
      return false; // Отменяем отправку формы
    }
    return true; // Разрешаем отправку формы, если значение есть
  }

  document.getElementById('clientInput').addEventListener('change', function() {
    const selectedOption = Array.from(document.getElementById('clientsList').options)
            .find(option => option.value === this.value);
    if (selectedOption) {
      const clientId = selectedOption.getAttribute('data-id');
      document.getElementById('clientId').value = clientId; // устанавливаем значение скрытого поля
      document.getElementById('error-message').style.display = 'none'; // Скрываем сообщение об ошибке при успешном выборе клиента
    } else {
      document.getElementById('clientId').value = ''; // Очищаем скрытое поле, если выбранного клиента нет в списке
    }
  });`;
                    document.body.appendChild(script);
                    clients.forEach(customer => {
                        const option = document.createElement('option');
                        switch (customer.typeOfClient) {
                            case 'ADULT':
                                option.value = customer.name + ' ' +customer.surname;
                                break;
                            case 'CHILD':
                                option.value = customer.childName + ' ' + customer.childSurname;
                                break;
                            case 'COUPLE':
                                option.value = customer.firstClientName + ' ' + customer.firstClientSurname;
                                break;
                            default:
                                // Здесь можно добавить код для обработки случая, если ни одно из значений не совпало
                                console.log('Unknown client type');
                                break;
                        }
                        option.setAttribute('data-id', customer.id);
                        dataList.appendChild(option);
                    });
                })
                .catch(error => console.error('Ошибка:', error));


        }

        // Функция для закрытия модального окна
        function closeModal() {
            modal.style.display = 'none';
            const script = document.getElementById('dynamic-script');
            if (script) {
                script.remove();
                console.log('Скрипт удалён');
            } else {
                console.log('Скрипт не найден');
            }
        }

    // Событие клика для открытия модального окна
    appointLink.addEventListener('click', openModal);

    // Событие клика для закрытия модального окна
    closeBtn.addEventListener('click', closeModal);
    });

    holidayBtn.addEventListener('click', openHolidayModal)
    function openHolidayModal()
    {
        const modal = document.getElementById("modal");
        const modalBody = document.getElementById("modal-body");

        fetch('/SimplePsy/V1/session/holiday')
            .then(response => response.text())
            .then(html => {
                modalBody.innerHTML = html;
                modal.style.display = "block";

                // Добавляем обработчик закрытия модального окна
                document.querySelector('.close-modal').onclick = function() {
                    modal.style.display = "none";
                };
            })
            .catch(error => {
                console.error('Error loading modal content:', error);
            });
    }
    const customerSearch = document.getElementById('customerSearch');
    const currentSpecialistId = document.getElementById('currentSpecialistId').value;

    customerSearch.addEventListener('input', function () {
        const searchQuery = this.value;
        const datalist = document.getElementById('customerList');

        if (searchQuery.length > 1) { // Минимум 2 символа для отправки запроса
            fetch(`/SimplePsy/V1/customer/findAll/${currentSpecialistId}`)
                .then(response => response.json())
                .then(data => {
                    // Очищаем предыдущие результаты
                    datalist.innerHTML = '';

                    // Фильтруем и сортируем клиентов в зависимости от типа
                    data.forEach(customer => {
                        let displayName = '';
                        if (customer.typeOfClient === 'ADULT') {
                            displayName = `${customer.name} ${customer.surname}`;
                        } else if (customer.typeOfClient === 'CHILD') {
                            displayName = `${customer.childName} ${customer.childSurname}`;
                        } else if (customer.typeOfClient === 'COUPLE') {
                            displayName = `${customer.firstClientName} ${customer.firstClientSurname}`;
                        }

                        if (displayName.toLowerCase().includes(searchQuery.toLowerCase())) {
                            const option = document.createElement('option');
                            option.value = displayName;
                            option.dataset.id = customer.id;
                            datalist.appendChild(option);
                        }
                    });
                })
                .catch(error => {
                    console.error('Ошибка при загрузке данных клиентов:', error);
                });
        }
    });

    customerSearch.addEventListener('change', function () {
        const selectedOption = Array.from(document.querySelectorAll('#customerList option'))
            .find(option => option.value === customerSearch.value);

        if (selectedOption) {
            const customerId = selectedOption.dataset.id;
            window.location.href = `/SimplePsy/V1/customer/customer-card/${customerId}`; // Передача username через GET-параметр
        }
    });

    let currentRequestId = 0; // Глобальная переменная для отслеживания активного запроса
    function openModalProjective(obj) {
        const requestId = ++currentRequestId;
        document.getElementById('modal-title').textContent = null;
        document.getElementById('modal-date').textContent = null;
        document.getElementById('modal-images').innerHTML = null;
        document.getElementById('modal-projective').style.display = 'block';
        const projectId = obj.getAttribute("data-card-id");
        const sessionId = document.getElementById("sessionId").value;

        fetch(`/SimplePsy/V1/session/getProjectiveMethod/${sessionId}/${projectId}`)
            .then(response => response.json())
            .then(data => {
                if (requestId !== currentRequestId) {
                    return; // Если это неактуальный запрос, игнорируем его результат
                }

                document.getElementById('modal-title').textContent = data.name;

                const imagesContainer = document.getElementById('modal-images');

                // Добавление новых изображений
                data.images.forEach(image => {
                    const imgElement = document.createElement('img');
                    const dateElement = document.createElement('p');
                    dateElement.textContent = image.date;
                    dateElement.classList.add('modal-date');
                    imgElement.src = `data:image/webp;base64,${image.image}`;
                    imgElement.classList.add('modal-image');
                    imgElement.setAttribute('loading', 'lazy');
                    imagesContainer.appendChild(dateElement);
                    imagesContainer.appendChild(imgElement);
                });

                // Открытие модального окна
                const modal = document.getElementById('modal-projective');
                modal.style.display = 'block';
            })
            .catch(error => {
                console.error('Ошибка загрузки данных методики:', error);
            });
    }

    function closeModalProjective() {
        const projective = document.getElementById("modal-projective");
        projective.style.display = "none";
    }
    function uploadImages() {
        const imageInput = document.getElementById('imageUpload');
        const errorMessage = document.getElementById('error-message');

        // Проверяем, выбран ли файл
        if (!imageInput.files || imageInput.files.length === 0) {
            errorMessage.textContent = 'Пожалуйста, добавьте фотографию.';
            errorMessage.style.display = 'block';
            return; // Прерываем выполнение функции
        } else {
            errorMessage.style.display = 'none'; // Скрываем сообщение об ошибке, если файл выбран
        }

        const projectId = document.querySelector('[data-card-id]').getAttribute('data-card-id');
        const sessionId = document.getElementById("sessionId").value;
        const formData = new FormData(document.getElementById('uploadForm'));

        fetch(`/SimplePsy/V1/session/projective/image/add/${sessionId}/${projectId}`, {
            method: 'POST',
            body: formData
        })
            .then(response => {
                if (response.ok) {
                    return response.json();
                } else {
                    throw new Error('Ошибка при загрузке изображений');
                }
            })
            .then(data => {
                // Обновляем список изображений
                const imageContainer = document.getElementById('modal-images');
                imageContainer.innerHTML = ''; // Очищаем контейнер

                data.images.forEach((image, index) => {
                    const imgElement = document.createElement('img');
                    imgElement.src = `data:image/jpeg;base64,${image}`;
                    imgElement.alt = `Image ${index + 1}`;
                    imgElement.classList.add('modal-image');
                    imageContainer.appendChild(imgElement);
                });
            })
            .catch(error => console.error('Ошибка при загрузке изображений:', error));
        location.reload();
    }

</script>
</body>
</html>
