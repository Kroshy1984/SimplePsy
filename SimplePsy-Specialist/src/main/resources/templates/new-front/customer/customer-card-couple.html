<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="initial-scale=1, width=device-width" />

  <link rel="stylesheet" type="text/css" th:href="@{/css/new-front/global.css}" />
  <link rel="stylesheet" type="text/css" th:href="@{/css/new-front/customer/customer-card-couple.css}" />
  <link
          rel="stylesheet"
          href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700;900&display=swap"
  />
  <link
          rel="stylesheet"
          href="https://fonts.googleapis.com/css2?family=Rubik:wght@400&display=swap"
  />
</head>
<body>
<div class="div216">
  <div class="settings6"></div>
  <div class="item112">
    <img class="feather-icon-chevron-up21" alt="" />
  </div>
  <section class="frame-parent141">
    <header class="frame-wrapper85">
      <div class="frame-parent142">
        <div class="frame-wrapper86">
          <div class="frame-parent143">
            <div class="icon-parent29">
              <img
                      class="icon156"
                      loading="lazy"
                      alt=""
                      src="/images/icon@2x.png"
              />

              <div class="constructor-wrapper4">
                <a class="constructor12">Понятная практика</a>
              </div>
              <div class="icon-parent30">
                <img
                        class="icon157"
                        loading="lazy"
                        alt=""
                        src="/images/icon-1@2x.png"
                />

                <div class="search-wrapper2">
                  <b class="search13">Найти клиента...</b>
                </div>
              </div>
            </div>
            <div class="about-content-wrapper">
              <div class="about-content">
                <a class="about-us19" onclick="window.location.href = '/SimplePsy/V1/customer/customer-form'">Добавить клиента</a>
                <div class="news-container">
                  <a class="news10">Назначить встречу</a>
                  <b class="user-policy13">Добавить график нерабочих дней</b>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="icon-parent31">
          <img class="icon158" alt="" src="/images/icon-2@2x.png" />

          <div class="new-york-wrapper4">
            <b th:text="${specialist.city}" class="specialist-city"></b>
          </div>
        </div>
      </div>
    </header>
    <div class="user-panel-content-parent">
      <div class="user-panel-content">
        <div class="frame-parent144">
          <div class="wrapper-user-wrapper2">
            <div class="wrapper-user12">
              <img
                      class="user-icon"
                      loading="lazy"
                      alt=""
                      th:src="@{'/SimplePsy/V1/specialist/avatar/' + ${specialist.id}}"
                      id="userImage"
                      onclick="window.location.href='/SimplePsy/V1/specialist/personal-info'"
              />
            </div>
          </div>
          <div class="user-names-content-wrapper">
            <div class="user-names-content">
              <div class="hello-wrapper">
                <b class="hello">Привет, </b>
                <b th:text="${specialist.name}" class="hello" ></b>
                <b class="hello">!</b>
              </div>
              <b class="specialist-email">
                <p th:text="${specialist.username}" class="specialist-email-content"></p>
              </b>
            </div>
          </div>
          <div class="navigation-content-parent">
            <div class="frame-wrapper73">
              <div class="frame-parent122">
                <div class="frame-parent123">
                  <div class="client-list-wrapper">
                    <button class="base90" onclick="window.location.href='/SimplePsy/V1/specialist/customers';"></button>
                    <div class="icon-wrapper33">
                      <img class="icon146" alt="" src="/images/icon-3@2x.png" />
                    </div>
                    <b class="client-list">Список клиентов</b>
                  </div>
                  <div class="base-frame">
                    <button class="calendar-wrapper" id="baseContainer" onclick="window.location.href='/SimplePsy/V1/session/calendar';">
                      <div class="icon-wrapper34">
                        <img class="icon147" alt="" src="/images/icon-41@2x.png"/>
                      </div>
                      <b class="calendar">Календарь</b>
                    </button>
                  </div>
                </div>
                <div class="frame-parent123">
                  <div class="notifications-wrapper">
                    <button class="base90 fix-angle-base90" onclick="alert('Эта кнопка находится в разработке')"></button>
                    <div class="icon-wrapper33">
                      <img class="icon146" alt="" src="/images/icon-5.svg" />
                    </div>
                    <b class="notifications">Уведомления</b>
                  </div>
                  <div class="base-frame">
                    <button class="calendar-wrapper" id="baseContainer" onclick="alert('Эта кнопка находится в разработке')">
                      <div class="icon-wrapper34">
                        <img class="icon147" alt="" src="/images/icon-6.svg"/>
                      </div>
                      <b class="analytics">Аналитика</b>
                    </button>
                  </div>
                  <div class="tests-wrapper">
                    <button class="base94" onclick="window.location.href='/SimplePsy/V1/scoring/list';"></button>
                    <b class="surveys-tests">Опросники и тесты</b>
                  </div>
                </div>
              </div>
            </div>
            <div class="applications-content-wrapper">
              <div class="applications-content">
                <div class="wrapper49">
                  <b class="b143">Заявки</b>
                </div>
                <div class="frame-parent145">
                  <div class="frame-parent146" id="groupContainer">
                    <div class="rectangle-parent142">
                      <div class="frame-child168"></div>
                      <b class="application-item-icon">20.02.2024</b>
                    </div>
                    <div class="rectangle-parent143">
                      <div class="frame-child169"></div>
                      <b class="b144">Овсянникова Юля Матвеевна</b>
                    </div>
                  </div>
                  <div class="frame-parent147" id="groupContainer1">
                    <div class="rectangle-parent144">
                      <div class="frame-child170"></div>
                      <b class="b145">25.02.2024</b>
                    </div>
                    <div class="rectangle-parent145">
                      <div class="frame-child171"></div>
                      <b class="b146">Овсянникова Юля Матвеевна</b>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="client-card-actions">
        <div class="client-card-actions-content">
          <div class="frame-parent148">
            <button class="rectangle-parent146" onclick="window.location.href='/SimplePsy/V1/specialist/customers';">
              <div class="frame-child172"></div>
              <a class="a">Список клиентов</a>
            </button>
            <button class="rectangle-parent147" onclick="window.location.href='/SimplePsy/V1/session/sessions';">
              <div class="frame-child173"></div>
              <a class="a1">Список встреч</a>
            </button>
            <div class="rectangle-parent148" id="groupContainer" onclick="window.location.href='/SimplePsy/V1/scoring/list';">
              <div class="frame-child174"></div>
              <div class="div217">Опросники и тесты</div>
            </div>
          </div>
        </div>
        <div class="client-card-actions-inner">
          <div class="frame-parent149">
            <div class="rectangle-parent149">
              <div class="frame-child175"></div>
              <div class="div218">Редактировать</div>
            </div>
            <div class="rectangle-parent150">
              <div class="frame-child176"></div>
              <div class="div219">Сохранить</div>
            </div>
            <div class="rectangle-parent151">
              <div class="frame-child177"></div>
              <div class="div220">Ссылка на анкету</div>
            </div>
          </div>
        </div>
        <div class="component19">
          <div class="item113">
            <div class="div221">Тип клиента</div>
            <div class="div222" th:text="${customer.typeOfClient.translation}"></div>
          </div>
          <div class="item113">
            <div class="div221">Статус клиента</div>
            <div class="div222" th:text="${customer.clientStatus.translation}"></div>
          </div>
          <div class="item114">
            <div class="div223">ФИО первого клиента</div>
            <div class="string10" th:text="${customer.firstClientSurname + ' ' + customer.firstClientName + ' ' + customer.firstClientLastName}">
            </div>
          </div>
          <div class="item115">
            <div class="div224">Номер телефона первого клиента</div>
            <div class="int4" th:text="${customer.firstClientContact.phone}"></div>
          </div>
          <div class="item116">
            <div class="div225">Почта первого клиента</div>
            <div class="kirraaagmailcom-string1" th:text="${customer.firstClientContact.email}">
            </div>
          </div>
          <div class="item117">
            <div class="div226">Пол первого клиента</div>
            <div class="div227" th:text="${customer.firstClientSex.translation}"></div>
          </div>
          <div class="item117">
            <div class="div226">Запрос первого клиента на терапию: причина обращения</div>
            <div class="div227" th:text="${customer.firstClientRequestReason}"></div>
          </div>
          <div class="item117">
            <div class="div226">Запрос первого клиента на терапию: желаемый результат от прохождения терапии</div>
            <div class="div227" th:text="${customer.firstClientDesiredResult}"></div>
          </div>
          <div class="item114">
            <div class="div223">ФИО второго клиента</div>
            <div class="string10" th:text="${customer.secondClientSurname + ' ' + customer.secondClientName + ' ' + customer.secondClientLastName}">
            </div>
          </div>
          <div class="item115">
            <div class="div224">Номер телефона второго клиента</div>
            <div class="int4" th:text="${customer.secondClientContact.phone}"></div>
          </div>
          <div class="item116">
            <div class="div225">Почта второго клиента</div>
            <div class="kirraaagmailcom-string1" th:text="${customer.secondClientContact.email}">
            </div>
          </div>
          <div class="item117">
            <div class="div226">Пол второго клиента</div>
            <div class="div227" th:text="${customer.secondClientSex.translation}"></div>
          </div>
          <div class="item117">
            <div class="div226">Запрос второго клиента на терапию: причина обращения</div>
            <div class="div227" th:text="${customer.secondClientRequestReason}"></div>
          </div>
          <div class="item117">
            <div class="div226">Запрос второго клиента на терапию: желаемый результат от прохождения терапии</div>
            <div class="div227" th:text="${customer.secondClientDesiredResult}"></div>
          </div>
          <div class="item120">
            <div class="div231">
              Каким способом обратился клиент/попечитель
            </div>
            <div class="div232" th:text="${customer.typeOfTreatment.translation}"></div>
          </div>
          <div class="item121">
            <div class="div233">
              Дата первого обращения (запрос на консультацию)
            </div>
            <div class="int5" th:text="${customer.dateOfFirstRequest}"></div>
          </div>
          <div class="item122">
            <div class="div234">Дата первой консультации</div>
            <div class="int6" th:text="${customer.dateOfFirstConsultation}"></div>
          </div>
          <div class="item123">
            <div class="div235">Предпочтительный формат встречи</div>
            <div class="div236" th:text="${customer.preferredMeetingFormat.translation}"></div>
          </div>
          <div class="item124">
            <div class="div237">
              Для онлайн выбрать/указать площадку взаимодействия
            </div>
            <div class="zoom1" th:text="${customer.onlineMeetingPlace.translation}"></div>
          </div>
          <div class="item125">
            <div class="div238">
              Для оффлайн выбрать адрес проведения встречи
            </div>
            <div class="string11" th:text="${customer.offlineMeetingPlace}"></div>
          </div>
          <div class="item127">
            <div class="div241">
              Первичный/изначальный запрос клиента на терапию
            </div>
            <div class="string12" th:text="${customer.clientsFirstRequestForTherapy}"></div>
          </div>
          <div class="item128">
            <div class="div242">
              Фиксированное время/день недели для встречи (если да, то
              указать)
            </div>
            <div class="string13" th:text="${customer.fixedTimeForMeeting}"></div>
          </div>
          <div class="item129">
            <div class="div243">Финансовые условия</div>
            <div class="string13" th:text="${customer.financialConditions}"></div>
          </div>
        </div>
      </div>
    </div>
  </section>
  <section class="footer-content-wrapper">
    <div class="footer-content">
      <div class="feedback-content-wrapper">
        <div class="feedback-content">
          <img
                  class="icon164"
                  loading="lazy"
                  alt=""
                  src="/images/icon-7@2x.png"
          />

          <div class="frame-parent150">
            <div class="send-feedback-wrapper6">
              <b class="send-feedback12">Обратная связь</b>
            </div>
            <img
                    class="icon165"
                    loading="lazy"
                    alt=""
                    src="/images/icon-8.svg"
            />
          </div>
        </div>
      </div>
      <div class="client-details-content-parent">
        <div class="client-details-content">
          <div class="div244">Подробнее....</div>
        </div>
        <div class="client-details-form">
          <div class="item130">
            <div class="div245">Дата рождения</div>
            <div class="int7" th:text="${customer.dateOfBirth}"></div>
          </div>
          <div class="item131">
            <div class="div246">Адрес проживания</div>
            <div class="string14" th:text="${customer.residentialAddress}"></div>
          </div>
          <div class="item132">
            <div class="div247">
              Коллегиальные рекомендации (поле для заполнения кто вас
              порекомендовал клиенту)
            </div>
            <div class="string15" th:text="${customer.collegialRecommendations}"></div>
          </div>
          <div class="item133">
            <div class="div248">Особые условия контракта</div>
            <div class="string16" th:text="${customer.specialTermsOfContract}"></div>
          </div>
          <div class="item134">
            <div class="div249">Семейное положение</div>
            <div class="div250" th:text="${customer.familyStatus.translation}"></div>
          </div>
          <div class="item137">
            <div class="div253">
              Приоритетный канал коммуникации (выпадающий список куда
              писать)
            </div>
            <div class="telegram3" th:text="${customer.priorityCommunicationChannel.translation}"></div>
          </div>
          <div class="item138">
            <div class="div254">
              Берется ли супервизия на данного клиента
            </div>
            <div class="div255" id="is-supervised" th:value="${customer.supervised}" th:text="${customer.supervised.translation}"></div>
          </div>

          <div id="supervisor-fields">
            <div class="item139">
              <div class="div256">ФИО супервизора</div>
              <div class="string19" th:text="${customer.supervisorsSurname + ' ' + customer.supervisorsName + ' ' + customer.supervisorsLastName}"></div>
            </div>
            <div class="item139">
              <div class="div256">Номер телефона супервизора</div>
              <div class="string19" th:text="${customer.supervisorsContact.getPhone()}"></div>
            </div>
            <div class="item139">
              <div class="div256">Электронная почта супервизора</div>
              <div class="string19" th:text="${customer.supervisorsContact.getEmail()}"></div>
            </div>
            <div class="item140">
              <div class="div257">
                Материал для следующих сеансов из супервизии
              </div>
              <div class="string20" th:text="${customer.materialForNextSessionsFromSupervision}"></div>
            </div>
          </div>

          <div class="item139">
            <div class="div256">ФИО котерапевта</div>
            <div class="string19" th:text="${customer.cotherapistSurname + ' ' + customer.cotherapistName + ' ' + customer.cotherapistLastName}"></div>
          </div>
          <div class="item139">
            <div class="div256">Номер телефона котерапевта</div>
            <div class="string19" th:text="${customer.cotherapistContact.getPhone()}"></div>
          </div>
          <div class="item139">
            <div class="div256">Электронная почта котерапевта</div>
            <div class="string19" th:text="${customer.cotherapistContact.getEmail()}"></div>
          </div>
          <div class="item141">
            <div class="div258">Условия распределения гонорара между котерапевтами</div>
            <div class="string21" th:text="${customer.cotherapistPaymentConditions}"></div>
          </div>
          <div class="item141">
            <div class="div258">Заметки</div>
            <div class="string21" th:text="${customer.notes}"></div>
          </div>
        </div>
      </div>
    </div>
  </section>
  <div id="modal" class="modal">
    <div class="modal-content">
      <span class="close-btn">&times;</span>
      <div id="modal-body"></div>
    </div>
  </div>
</div>

<script>
  function checkSupervisorFields() {
    const supervised = document.getElementById('is-supervised').getAttribute('value');
    document.getElementById('supervisor-fields').style.display = supervised === 'YES' ? 'block' : 'none';
  }

  // Initialize form
  checkSupervisorFields();

  // Открытие модального окна создания сессии
  document.addEventListener('DOMContentLoaded', function() {
    // Получаем элементы
    var modal = document.getElementById('modal');
    var modalBody = document.getElementById('modal-body');
    var closeBtn = document.querySelector('.close-btn');
    var appointLink = document.querySelector('.news10'); // Элемент "Назначить встречу"
    var holidayBtn = document.querySelector('.user-policy13');

    // Функция для открытия модального окна
    function openModal() {
      fetch('http://localhost:8081/SimplePsy/V1/session/session-form')
              .then(response => response.text())
              .then(data => {
                modalBody.innerHTML = data;
                modal.style.display = 'block';
              })
              .catch(error => console.error('Ошибка загрузки:', error));

      fetch('/SimplePsy/V1/client/findAll')
              .then(response => response.json())
              .then(clients => {
                const dataList = document.getElementById('clientsList');
                dataList.innerHTML = '';

                const script = document.createElement('script');
                script.id = 'dynamic-script';
                script.textContent = `
  document.getElementById('clientInput').addEventListener('change', function() {
    const selectedOption = Array.from(document.getElementById('clientsList').options).find(option => option.value === this.value);
    if (selectedOption) {
      const clientId = selectedOption.getAttribute('data-id');
      document.getElementById('clientId').value = clientId; // устанавливаем значение скрытого поля
    }
  });
  // Функция для валидации формы
  function validateForm() {
    const clientId = document.getElementById('clientId').value;
    if (!clientId) {
      document.getElementById('error-message').style.display = 'block'; // Показываем сообщение об ошибке
      return false; // Отменяем отправку формы
    }
    return true; // Разрешаем отправку формы, если значение есть
  }

  document.getElementById('clientInput').addEventListener('change', function() {
    const selectedOption = Array.from(document.getElementById('clientsList').options)
            .find(option => option.value === this.value);
    if (selectedOption) {
      const clientId = selectedOption.getAttribute('data-id');
      document.getElementById('clientId').value = clientId; // устанавливаем значение скрытого поля
      document.getElementById('error-message').style.display = 'none'; // Скрываем сообщение об ошибке при успешном выборе клиента
    } else {
      document.getElementById('clientId').value = ''; // Очищаем скрытое поле, если выбранного клиента нет в списке
    }
  });`;
                document.body.appendChild(script);
                clients.forEach(client => {
                  const option = document.createElement('option');
                  option.value = client.name;
                  option.setAttribute('data-id', client.id);
                  dataList.appendChild(option);
                });
              })
              .catch(error => console.error('Ошибка:', error));


    }

    // Функция для закрытия модального окна
    function closeModal() {
      modal.style.display = 'none';
      const script = document.getElementById('dynamic-script');
      if (script) {
        script.remove();
        console.log('Скрипт удалён');
      } else {
        console.log('Скрипт не найден');
      }
    }

    function openHolidayModal()
    {
      const modal = document.getElementById("modal");
      const modalBody = document.getElementById("modal-body");

      fetch('/SimplePsy/V1/session/holiday')
              .then(response => response.text())
              .then(html => {
                modalBody.innerHTML = html;
                modal.style.display = "block";

                // Добавляем обработчик закрытия модального окна
                document.querySelector('.close-modal').onclick = function() {
                  modal.style.display = "none";
                };
              })
              .catch(error => {
                console.error('Error loading modal content:', error);
              });
    }

    // Закрытие модального окна при клике вне его содержимого
    window.onclick = function(event) {
      const modal = document.getElementById("modal");
      if (event.target == modal) {
        modal.style.display = "none";
      }
    }

    appointLink.addEventListener('click', openModal);
    holidayBtn.addEventListener('click', openHolidayModal);
    closeBtn.addEventListener('click', closeModal);
  })
</script>
</body>
</html>
