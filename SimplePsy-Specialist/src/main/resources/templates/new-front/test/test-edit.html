<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="initial-scale=1, width=device-width" />

    <link rel="stylesheet" type="text/css" th:href="@{/css/new-front/global.css}" />
    <link rel="stylesheet" type="text/css" th:href="@{/css/new-front/default-page.css}" />
    <link
            rel="stylesheet"
            href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700;900&display=swap"
    />
    <link
            rel="stylesheet"
            href="https://fonts.googleapis.com/css2?family=Rubik:wght@400&display=swap"
    />
</head>
<body>
<style>
    body {
        font-family: Arial, sans-serif;
        margin: 20px;
    }
    .container {
        max-width: 800px;
        margin: 0 auto;
    }
    .form-group {
        margin-bottom: 15px;
    }
    label {
        display: block;
        margin-bottom: 5px;
    }
    input, textarea, select {
        width: 100%;
        padding: 8px;
        box-sizing: border-box;
    }
    button {
        padding: 10px 15px;
        background-color: #007BFF;
        color: white;
        border: none;
        cursor: pointer;
    }
    button:hover {
        background-color: #0056b3;
    }
</style>
<div class="div139">
    <div class="sidebar1">
        <div class="menu">
            <div class="dashboard23" id="dashboardContainer">
                <div class="base75"></div>
                <b class="dashboard24">Список клинетов</b>
                <img
                        class="icon115"
                        loading="lazy"
                        alt=""
                        src="/images/icon-3@2x.png"
                />
            </div>
            <div class="invoice15" id="invoiceContainer">
                <div class="base76"></div>
                <b class="invoice16">Уведомления</b>
                <img
                        class="icon116"
                        loading="lazy"
                        alt=""
                        src="/images/icon-5.svg"
                />
            </div>
            <div class="files8">
                <div class="base77"></div>
                <b class="files9">Аналитика</b>
                <img
                        class="icon117"
                        loading="lazy"
                        alt=""
                        src="/images/icon-6.svg"
                />
            </div>
            <div class="email3">
                <div class="base78"></div>
                <b class="calendars8">Календарь</b>
                <img
                        class="icon118"
                        loading="lazy"
                        alt=""
                        src="/images/icon-4@2x.png"
                />
            </div>

            <div class="div140" id="container">
                <div class="base79"></div>
                <b class="dashboard25">Опросники и тесты</b>
            </div>
            <div class="parent26">
                <b class="b112">Заявки</b>
                <div class="rectangle-parent87" id="groupContainer">
                    <div class="frame-child111"></div>
                    <div class="frame-child112"></div>
                    <b class="b113">Овсянникова Юля Матвеевна</b>
                    <b class="b114">20.02.2024</b>
                </div>
                <div class="rectangle-parent88" id="groupContainer1">
                    <div class="frame-child113"></div>
                    <div class="frame-child114"></div>
                    <b class="b115">Овсянникова Кирилл Матвеев</b>
                    <b class="b116">25.02.2024</b>
                </div>
            </div>
        </div>
        <div class="feedback3">
            <b class="send-feedback8">Обратная связь</b>
            <img
                    class="icon119"
                    loading="lazy"
                    alt=""
                    src="/images/icon-7@2x.png"
            />

            <img
                    class="icon120"
                    loading="lazy"
                    alt=""
                    src="/images/icon-8.svg"
            />
        </div>

        <div class="head">
            <div class="wrapper-user8">
                <img
                        class="user-icon8"
                        loading="lazy"
                        alt=""
                        src="/images/user@2x.png"
                        id="userImage"
                />
            </div>
            <b class="hello-rosalie8">Привет, Антон!</b>
            <b class="rosaliericegmailc8">rosalie.rice@gmail.com</b>
        </div>
    </div>
    <header class="head1">
        <div class="navigate">
            <a class="constructor8">Понятная практика</a>
            <div class="menu1">
                <b class="news9" id="newsText">Назначить встречу</b>
                <b class="user-policy9" id="userPolicyText"
                >Добавить график нерабочих дней
                </b>
                <b class="about-us15" id="aboutUsText">Добавить клиента</b>
            </div>
            <div class="search8">
                <b class="search9">Найти клиента...</b>
                <img
                        class="icon121"
                        loading="lazy"
                        alt=""
                        src="/images/icon-1@2x.png"
                />
            </div>
            <div class="city">
                <b class="new-york8">Ростов-на-Дону</b>
                <img
                        class="icon122"
                        loading="lazy"
                        alt=""
                        src="/images/icon-2@2x.png"
                />
            </div>
            <img
                    class="icon123"
                    loading="lazy"
                    alt=""
                    src="/images/icon@2x.png"
            />
        </div>
    </header>
    <div class="container">
        <h1>Edit Test</h1>
        <form id="surveyForm" th:object="${scoring}" method="post" th:action="@{/SimplePsy/V1/scoring/test/update}">
            <input type="hidden" th:field="*{id}" />

            <div class="form-group">
                <label for="title">Title</label>
                <input type="text" id="title" th:field="*{title}" required>
            </div>

            <div th:each="question, iterStat : ${scoring.questions}" class="question-container">
                <div class="form-group">
                    <label th:for="'questionText' + ${iterStat.index}">Question [[${iterStat.index + 1}]]</label>
                    <textarea th:id="'questionText' + ${iterStat.index}" th:field="*{questions[__${iterStat.index}__].questionText}" required></textarea>
                </div>
                <div id="optionsContainer-[[${iterStat.index}]]" th:each="option, optStat : ${question.options}" class="options-container">
                    <div class="form-group">
                        <label th:for="'option' + ${iterStat.index} + '-' + ${optStat.index}">Option [[${optStat.index + 1}]]</label>
                        <input type="text" th:id="'option' + ${iterStat.index} + '-' + ${optStat.index}" th:field="*{questions[__${iterStat.index}__].options[__${optStat.index}__]}" required>
                    </div>
                </div>
                <button type="button" class="add-option-button" th:onclick="'addOption(' + ${iterStat.index} + ')'">Добавить вариант ответа</button>
            </div>

            <div id="questionsContainer"></div>

            <button type="button" class="add-question-button" onclick="addQuestion()">Добавить вопрос</button>
            <button type="submit">Save</button>
        </form>
    </div>

    <script>
        function addOption(questionIndex) {
            const optionsContainer = document.getElementById(`optionsContainer-${questionIndex}`);
            const newOptionIndex = optionsContainer.children.length;
            const newOption = document.createElement("div");
            newOption.className = "form-group";
            newOption.innerHTML = `
            <label for="option${questionIndex}-${newOptionIndex}">Option ${newOptionIndex + 1}</label>
            <input type="text" id="option${questionIndex}-${newOptionIndex}" name="questions[${questionIndex}].options[${newOptionIndex}]" required>
        `;
            optionsContainer.appendChild(newOption);
        }

        function addQuestion() {
            const questionsContainer = document.getElementById("questionsContainer");
            const questionIndex = questionsContainer.children.length;
            const newQuestion = document.createElement("div");
            newQuestion.className = "question-container";
            newQuestion.innerHTML = `
            <div class="form-group">
                <label for="questionText${questionIndex}">Question ${questionIndex + 1}</label>
                <textarea id="questionText${questionIndex}" name="questions[${questionIndex}].questionText" required></textarea>
            </div>
            <div id="optionsContainer-${questionIndex}" class="options-container">
                <div class="form-group">
                    <label for="option${questionIndex}-0">Option 1</label>
                    <input type="text" id="option${questionIndex}-0" name="questions[${questionIndex}].options[0]" required>
                </div>
            </div>
            <button type="button" class="add-option-button" onclick="addOption(${questionIndex})">Добавить вариант ответа</button>
        `;
            questionsContainer.appendChild(newQuestion);
        }

        document.getElementById("surveyForm").addEventListener("submit", function(event) {
            event.preventDefault();
            const form = event.target;
            const formData = new FormData(form);

            const data = {};
            formData.forEach((value, key) => {
                if (key.includes('[')) {
                    const keys = key.split('[').map(k => k.replace(']', ''));
                    keys.reduce((acc, k, i) => {
                        if (i === keys.length - 1) {
                            acc[k] = value;
                        } else {
                            acc[k] = acc[k] || {};
                        }
                        return acc[k];
                    }, data);
                } else {
                    data[key] = value;
                }
            });

            fetch(form.action, {
                method: form.method,
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data),
            })
                .then(response => response.json())
                .then(data => {
                    console.log('Survey updated:', data);
                    // Redirect or show success message
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        });
    </script>
</body>
</html>
