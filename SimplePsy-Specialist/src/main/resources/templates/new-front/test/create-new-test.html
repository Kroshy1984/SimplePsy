<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="initial-scale=1, width=device-width"/>

    <link rel="stylesheet" type="text/css" th:href="@{/css/new-front/global.css}"/>
    <link rel="stylesheet" type="text/css" th:href="@{/css/new-front/test/create-new-test.css}"/>
    <link
            rel="stylesheet"
            href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700;900&display=swap"
    />
    <link
            rel="stylesheet"
            href="https://fonts.googleapis.com/css2?family=Rubik:wght@400&display=swap"
    />
</head>
<body>
<div class="div340">
    <div class="settings9"></div>
    <div class="inner1">
        <div class="frame-parent166">
            <header class="frame-wrapper99">
                <div class="frame-parent167">
                    <div class="icon-parent35">
                        <img
                                class="icon187"
                                loading="lazy"
                                alt=""
                                src="/images/icon@2x.png"
                        />

                        <div class="constructor-wrapper6">
                            <a class="constructor15" href="/SimplePsy/V1/session/calendar">Понятная практика</a>
                        </div>
                        <div class="icon-parent36">
                            <img
                                    class="icon188"
                                    loading="lazy"
                                    alt=""
                                    src="/images/icon-1@2x.png"
                            />
                            <input type="hidden" id="currentSpecialistId" th:value="${specialist.id}">
                            <div class="search-wrapper4">
                                <input type="text" class="search1" placeholder="Найти клиента..." list="customerList" id="customerSearch">
                                <datalist id="customerList">

                                </datalist>
                            </div>
                        </div>
                    </div>
                    <div class="frame-wrapper100">
                        <div class="about-us-parent7">
                            <a class="about-us23">Добавить клиента</a>
                            <div class="policy-menu">
                                <a class="news10">Назначить встречу</a>
                                <b class="user-policy16">Добавить график нерабочих дней </b>
                            </div>
                        </div>
                    </div>
                </div>
            </header>
            <div class="icon-parent37">
                <img class="icon189" alt="" src="/images/icon-2@2x.png"/>

                <div class="new-york-wrapper6">
                    <b th:text="${specialist.city}" class="specialist-city"></b>
                </div>
            </div>
        </div>
    </div>
    <main class="frame-parent168">
        <section class="frame-parent169">
            <div class="dashboard-menu-content-wrapper">
                <div class="dashboard-menu-content">
                    <div class="dashboard-menu-content-inner">
                        <img
                                class="frame-child205"
                                loading="lazy"
                                alt=""
                                src="/images/arrow-13.svg"
                                id="arrowIcon"
                        />
                    </div>
                    <div class="wrapper-user-wrapper3">
                        <div class="wrapper-user-parent">
                            <div class="wrapper-user15">
                                <img
                                        class="user-icon"
                                        loading="lazy"
                                        alt=""
                                        th:src="@{'/SimplePsy/V1/specialist/avatar/' + ${specialist.id}}"
                                        id="userImage"
                                        onclick="window.location.href='/SimplePsy/V1/specialist/personal-info'"
                                />
                            </div>
                            <div class="frame-parent50">
                                <div class="hello-wrapper">
                                    <b class="hello">Привет, </b>
                                    <b th:text="${specialist.name}" class="hello" ></b>
                                    <b class="hello">!</b>
                                </div>
                                <b class="specialist-email">
                                    <p th:text="${specialist.username}" class="specialist-email-content"></p>
                                </b>
                            </div>
                        </div>
                    </div>
                    <div class="frame-wrapper73">
                        <div class="frame-parent122">
                            <div class="frame-parent123">
                                <div class="client-list-wrapper">
                                    <button class="base90" onclick="window.location.href='/SimplePsy/V1/specialist/customers';"></button>
                                    <div class="icon-wrapper33">
                                        <img class="icon146" alt="" src="/images/icon-3@2x.png" />
                                    </div>
                                    <b class="client-list">Список клиентов</b>
                                </div>
                                <div class="base-frame">
                                    <button class="calendar-wrapper" id="baseContainer" onclick="window.location.href='/SimplePsy/V1/session/calendar';">
                                        <div class="icon-wrapper34">
                                            <img class="icon147" alt="" src="/images/icon-41@2x.png"/>
                                        </div>
                                        <b class="calendar">Календарь</b>
                                    </button>
                                </div>
                            </div>
                            <div class="frame-parent123">
                                <div class="notifications-wrapper">
                                    <button class="base90 fix-angle-base90" onclick="alert('Эта кнопка находится в разработке')"></button>
                                    <div class="icon-wrapper33">
                                        <img class="icon146" alt="" src="/images/icon-5.svg" />
                                    </div>
                                    <b class="notifications">Уведомления</b>
                                </div>
                                <div class="base-frame">
                                    <button class="calendar-wrapper" id="baseContainer" onclick="alert('Эта кнопка находится в разработке')">
                                        <div class="icon-wrapper34">
                                            <img class="icon147" alt="" src="/images/icon-6.svg"/>
                                        </div>
                                        <b class="analytics">Аналитика</b>
                                    </button>
                                </div>
                                <div class="tests-wrapper">
                                    <button class="base94" onclick="window.location.href='/SimplePsy/V1/scoring/list';"></button>
                                    <b class="surveys-tests">Опросники и тесты</b>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="wrapper58">
                        <b class="b158">Заявки</b>
                    </div>
                </div>
            </div>
            <form id="testForm" onsubmit="sendForm(event)" class="create-test-content-parent">
                <div class="create-test-content">
                    <div class="create-test-header">
                        <div class="create-test-type">
                            <div class="create-test-type-content">
                                <button class="rectangle-parent172" type="button" onclick="window.location.href='/SimplePsy/V1/scoring/creation';">
                                    <div class="frame-child206"></div>
                                    <div class="div342">Опросы</div>
                                </button>
                                <div class="create-test-type-content-inner">
                                    <div class="rectangle-parent173">
                                        <div class="frame-child207"></div>
                                        <h3 class="h38">Тесты</h3>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="rectangle-parent174">
                            <div class="frame-child208"></div>
                            <button class="h39" type="submit" style="cursor:pointer;">Создать</button>
                        </div>
                    </div>
                </div>
                <div class="parent29">
                    <div class="div343">Название теста</div>
                    <div class="test-name-input">
                        <div class="test-name-rect"></div>
                        <input name="title" class="input21" placeholder="....." type="text" required />
                    </div>
                </div>
                <div id="questions-container">
                    <div class="frame-wrapper101 question-block">
                        <div class="rectangle-parent175">
                            <div class="frame-child209"></div>
                            <div class="question-content-wrapper">
                                <div class="question-content1">
                                    <input name="questions[0].questionText" type="text" class="h214 editable-heading" placeholder="Новый вопрос" required>
                                    <div class="answer">
                                        <input name="questions[0].options[0]" type="text" class="editable-option" placeholder="Да" required>
                                    </div>
                                    <div class="answer">
                                        <input name="questions[0].options[1]" type="text" class="editable-option" placeholder="Нет" required>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <h2 id="addQuestionBtn" class="h215" role="button" style="cursor:pointer;">Добавить вопрос...</h2>
            </form>
        </section>
        <div class="frame-wrapper102">
            <div class="frame-parent170" id="groupContainer">
                <div class="rectangle-parent177">
                    <div class="frame-child214"></div>
                    <b class="user-avatar1">20.02.2024</b>
                </div>
                <div class="rectangle-parent178">
                    <div class="frame-child215"></div>
                    <b class="b161">Овсянникова Юля Матвеевна</b>
                </div>
            </div>
        </div>
        <div class="frame-wrapper103">
            <div class="frame-parent171" id="groupContainer">
                <div class="rectangle-parent179">
                    <div class="frame-child216"></div>
                    <b class="b162">25.02.2024</b>
                </div>
                <div class="rectangle-parent180">
                    <div class="frame-child217"></div>
                    <b class="b163">Овсянникова Юля Матвеевна</b>
                </div>
            </div>
        </div>
    </main>
    <div class="item196">
        <img class="feather-icon-chevron-up25" alt=""/>
    </div>
    <div class="feedback-container2">
        <div class="feedback-row">
            <img
                    class="icon195"
                    loading="lazy"
                    alt=""
                    src="/images/icon-7@2x.png"
            />

            <div class="feedback-label-parent">
                <div class="feedback-label3">
                    <b class="send-feedback15">Обратная связь</b>
                </div>
                <img
                        class="icon196"
                        loading="lazy"
                        alt=""
                        src="/images/icon-8.svg"
                />
            </div>
        </div>
    </div>
</div>
<div id="modal" class="modal">
    <div class="modal-content">
        <span class="close-btn">&times;</span>
        <div id="modal-body"></div>
    </div>
</div>
<script>
    function sendForm(event) {
        event.preventDefault();

        const form = document.getElementById('testForm');
        const formData = new FormData(form);
        const data = {
            title: formData.get('title'),
            questions: []
        };

        document.querySelectorAll('.question-block').forEach((block, index) => {
            const questionText = formData.get(`questions[${index}].questionText`);
            const options = [
                formData.get(`questions[${index}].options[0]`),
                formData.get(`questions[${index}].options[1]`)
            ];
            data.questions.push({
                questionText,
                options
            });
        });

        fetch('/SimplePsy/V1/scoring/test/creation', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(data)
        })
            .then(response => response.text())
            .then(response => {
                console.log(response);
                window.location = "/SimplePsy/V1/scoring/list";
            })
            .catch(error => {
                console.error('Error:', error);
            });
    }

    document.getElementById('addQuestionBtn').addEventListener('click', () => {
        const questionsContainer = document.getElementById('questions-container');
        const questionBlocks = document.querySelectorAll('.question-block');
        const newIndex = questionBlocks.length;

        const newQuestionBlock = document.createElement('div');
        newQuestionBlock.className = 'frame-wrapper101 question-block';
        newQuestionBlock.innerHTML = `
                <div class="rectangle-parent175">
                    <div class="frame-child209"></div>
                    <div class="question-content-wrapper">
                        <div class="question-content1">
                            <input name="questions[${newIndex}].questionText" type="text" class="h214 editable-heading" placeholder="Новый вопрос">
                            <div class="answer">
                                <input name="questions[${newIndex}].options[0]" type="text" class="editable-option" placeholder="Да">
                            </div>
                            <div class="answer">
                                <input name="questions[${newIndex}].options[1]" type="text" class="editable-option" placeholder="Нет">
                            </div>
                        </div>
                    </div>
                </div>
            `;

        questionsContainer.appendChild(newQuestionBlock);
    });
    // Открытие модального окна создания сессии
    document.addEventListener('DOMContentLoaded', function() {
    // Получаем элементы
    var modal = document.getElementById('modal');
    var modalBody = document.getElementById('modal-body');
    var closeBtn = document.querySelector('.close-btn');
    var appointLink = document.querySelector('.news10'); // Элемент "Назначить встречу"
    var holidayBtn = document.querySelector('.user-policy16');

    // Функция для открытия модального окна
        function openModal() {
            fetch('/SimplePsy/V1/session/session-form')
                .then(response => response.text())
                .then(data => {
                    modalBody.innerHTML = data;
                    modal.style.display = 'block';
                })
                .catch(error => console.error('Ошибка загрузки:', error));

            fetch('/SimplePsy/V1/customer/findAll')
                .then(response => response.json())
                .then(clients => {
                    const dataList = document.getElementById('clientsList');
                    dataList.innerHTML = '';

                    clients.forEach(customer => {
                        const option = document.createElement('option');
                        switch (customer.typeOfClient) {
                            case 'ADULT':
                                option.value = customer.name + ' ' +customer.surname;
                                break;
                            case 'CHILD':
                                option.value = customer.childName + ' ' + customer.childSurname;
                                break;
                            case 'COUPLE':
                                option.value = customer.firstClientName + ' ' + customer.firstClientSurname;
                                break;
                            default:
                                // Здесь можно добавить код для обработки случая, если ни одно из значений не совпало
                                console.log('Unknown client type');
                                break;
                        }
                        option.setAttribute('data-id', customer.id);
                        dataList.appendChild(option);
                    });
                })
                .catch(error => console.error('Ошибка:', error));

            const script = document.createElement('script');
            script.id = 'dynamic-script';
            script.textContent = `
                   document.getElementById('clientInput').addEventListener('change', function() {
        const selectedOption = Array.from(document.getElementById('clientsList').options)
                .find(option => option.value === this.value);
        if (selectedOption) {
          const clientId = selectedOption.getAttribute('data-id');
          document.getElementById('clientId').value = clientId; // устанавливаем значение скрытого поля
          document.getElementById('error-message').style.display = 'none'; // Скрываем сообщение об ошибке при успешном выборе клиента
        } else {
          document.getElementById('clientId').value = ''; // Очищаем скрытое поле, если выбранного клиента нет в списке
        }
      });`;
            document.body.appendChild(script);
        }

        // Функция для закрытия модального окна
        function closeModal() {
            modal.style.display = 'none';
            const script = document.getElementById('dynamic-script');
            if (script) {
                script.remove();
                console.log('Скрипт удалён');
            } else {
                console.log('Скрипт не найден');
            }
        }

        function openHolidayModal() {
            const modal = document.getElementById("modal");
            const modalBody = document.getElementById("modal-body");

            fetch('/SimplePsy/V1/session/holiday')
                .then(response => response.text())
                .then(html => {
                    modalBody.innerHTML = html;
                    modal.style.display = "block";

                    // Добавляем обработчик закрытия модального окна
                    document.querySelector('.close-modal').onclick = function () {
                        modal.style.display = "none";
                    };
                })
                .catch(error => {
                    console.error('Error loading modal content:', error);
                });
        }

    // Событие клика для открытия модального окна
    appointLink.addEventListener('click', openModal);
    holidayBtn.addEventListener('click', openHolidayModal);
    // Событие клика для закрытия модального окна
    closeBtn.addEventListener('click', closeModal);
    });

    var  addClientBtn = document.querySelector('.about-us23');
    addClientBtn.addEventListener('click', () =>
    {
        window.location.href = '/SimplePsy/V1/customer/customer-form';
    });
    const customerSearch = document.getElementById('customerSearch');
    const currentSpecialistId = document.getElementById('currentSpecialistId').value;

    customerSearch.addEventListener('input', function () {
        const query = customerSearch.value;

        if (query.length > 2) { // Запрашиваем данные только если введено больше 2 символов
            fetch(`/SimplePsy/V1/customer/findAll/${currentSpecialistId}`)
                .then(response => response.json())
                .then(customers => {
                    const filteredCustomers = customers.filter(customer =>
                        customer.name.toLowerCase().includes(query.toLowerCase()) ||
                        customer.surname.toLowerCase().includes(query.toLowerCase())
                    );

                    const dataList = document.getElementById('customerList');
                    dataList.innerHTML = ''; // Очищаем предыдущие результаты

                    filteredCustomers.forEach(customer => {
                        const option = document.createElement('option');
                        option.value = `${customer.name} ${customer.surname}`;
                        option.dataset.id = customer.id;
                        dataList.appendChild(option);
                    });
                });
        }
    });

    customerSearch.addEventListener('change', function () {
        const selectedOption = Array.from(document.querySelectorAll('#customerList option'))
            .find(option => option.value === customerSearch.value);

        if (selectedOption) {
            const customerId = selectedOption.dataset.id;
            window.location.href = `/SimplePsy/V1/customer/customer-card/${customerId}`; // Передача username через GET-параметр
        }
    });
</script>
</body>
</html>
